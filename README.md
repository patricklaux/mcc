# mcc

mcc (mini c compiler) 是一个小型的 C 编译器，仅支持有限的 C 语言特性，主要思路来源于 **C4**。

C4 仅用了极少量代码和极有限特性完成了自举（1个文件4个函数），整个实现很精巧，但非常晦涩并不适合新手阅读。

正所谓：编译过程一遍过，递归调用循环调，全局变量随便变，类型转换强制转。

mcc 则走的是完全相反的路，一切以可阅读可理解为目标。

### 1. 编译运行

```bash
# 下载源码
git clone git@github.com:patricklaux/mcc.git

# 编译 mcc
gcc -o mcc ./src/mcc/lexer.c ./src/mcc/parser.c ./src/mcc/vm.c ./src/mcc/mcc.c

# 使用 mcc 运行测试代码
./mcc [-s] [-d] ./src/test/test1.c
```

**提示**：

1. 除了直接用 gcc 编译，也可以用 cmake，这里不再赘述。
3. -s 和 -d 为可选参数： -s 打印生成的指令，但不执行；-d 运行并打印整个运行过程。
3. Windows 10 (MinGW_w64 11.0) 和 Ubuntu 22.04 (gcc 11.4.0) 均可正常编译运行。

### 2. 设计概要



#### 主流程
![image-20250717123518810](images/README/image-20250717123518810.png)



#### 变量
相应地，也有三个 struct 用来保存变量

#### 符号表
符号表则分为全局符号表和局部符号表。

#### 

#### 其它

注释

64 位

### 3. 后续
如果要实现自举，需要支持 struct 结构体、switch 语句、前向声明函数等语言特性，与及多文件编译等。

难倒是不难，但代码将会不可避免地变得臃肿复杂，与此项目“简单可理解”的设计目标相违背，因此暂无计划去实现。

其实，我更感兴趣的是设计实现一个 c with class 的简单语言，与及将源码直接编译成 x86_64 平台的可执行文件……

